@layer viewtransitions {
  /* Step 1 - Enable view transitions */
  @media (prefers-reduced-motion: no-preference) {
    @view-transition {
      navigation: auto;
    }
  }

  /* Step 2 - Increase animation duration to see what actually happens during the view transition */
  ::view-transition-group(*) {
    animation-duration: 0.5s;
  }

  /* Step 3 - Create custom animations */
  @layer custom-animation {
    ::view-transition-old(root) {
      animation-name: slide-out;
    }
    ::view-transition-new(root) {
      animation-name: slide-in;
    }

    @keyframes scale-in {
      from {
        scale: 0;
      }
    }
    @keyframes scale-out {
      to {
        scale: 0;
      }
    }

    @keyframes slide-in {
      from {
        translate: 100vw 0;
      }
    }
    @keyframes slide-out {
      to {
        translate: -100vw 0;
      }
    }

    @keyframes scale-in-and-rotate {
      from {
        scale: 0;
        rotate: -1080deg;
      }
    }
    @keyframes scale-out-and-rotate {
      to {
        scale: 0;
        rotate: 1080deg;
      }
    }
  }

  /* Step 4 - Exclude header from slide animations */
  @layer header {
    header {
      view-transition-name: header;
    }
  }

  /* Step 5 - Add underline to active nav item */
  @layer current-page-indicator {
    [aria-current='page'] {
      position: relative;
    }

    [aria-current='page']::after {
      content: '';
      position: absolute;
      inset: 0;
      top: auto;
      bottom: -0.5em;
      background-color: currentColor;
      height: 0.25rem;
      view-transition-name: active-nav;
    }
  }

  /* Step 6 - Transition card content into place */
  @layer card {
    @layer article1 {
      #article1 .image,
      #article-page-1 .image {
        view-transition-name: image1;
      }
      #article1 a,
      #article-page-1 h1 {
        width: fit-content;
        view-transition-name: title1;
      }
      #article1 p,
      #article-page-1 .preamble {
        view-transition-name: desc1;
      }
    }

    @layer article2 {
      #article2 .image,
      #article-page-2 .image {
        view-transition-name: image2;
      }
      #article2 a,
      #article-page-2 h1 {
        width: fit-content;
        view-transition-name: title2;
      }
      #article2 p,
      #article-page-2 .preamble {
        view-transition-name: desc2;
      }
    }
  }

  /* Step 7 - Direction aware transitions. Disable step 3 and 6 for this to work properly */
  /* @layer direction {
    [data-direction='forwards']::view-transition-old(root) {
      animation-name: slide-out-left;
    }
    [data-direction='forwards']::view-transition-new(root) {
      animation-name: slide-in-right;
    }
    [data-direction='backwards']::view-transition-old(root) {
      animation-name: slide-out-right;
    }
    [data-direction='backwards']::view-transition-new(root) {
      animation-name: slide-in-left;
    }

    @keyframes slide-out-left {
      to {
        translate: -100% 0;
      }
    }
    @keyframes slide-in-right {
      from {
        translate: 100% 0;
      }
    }
    @keyframes slide-out-right {
      to {
        translate: 100% 0;
      }
    }
    @keyframes slide-in-left {
      from {
        translate: -100% 0;
      }
    }
  } */
}

@layer general {
  :root {
    --bg: light-dark(#ddd, #888);
    --shadow: 0 0 0.5rem light-dark(var(--bg), #444);
    --border-color: light-dark(var(--bg), #444);
    --link-color: light-dark(black, white);
  }

  main {
    margin-bottom: 2rem;
  }

  .wrapper {
    max-width: 60em;
    margin-inline: auto;
    padding-inline: 1rem;
  }

  .grid {
    display: grid;
    gap: 1rem;
    grid-template-columns: repeat(auto-fill, minmax(min(100%, 250px), 1fr));
  }

  header {
    border-bottom: 1px solid var(--border-color);
    box-shadow: var(--shadow);
  }
  nav {
    padding: 1.5rem 1rem;
  }
  nav > ul {
    display: flex;
    gap: 1rem;
    margin: 0;
    padding: 0;
    list-style: none;
  }
  nav a {
    color: var(--link-color);
    font-weight: bold;
    text-decoration: none;
  }

  .image {
    background-color: var(--color, var(--bg));
    aspect-ratio: 3 / 2;
  }

  .card {
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow);
  }
  .card-content {
    padding: 0 0.5rem;

    h2,
    p {
      width: fit-content;
    }
  }

  .category {
    --_category-color: light-dark(
      hsl(var(--category-hue) 50% 80%),
      hsl(var(--category-hue) 50% 30%)
    );

    display: inline-block;
    margin: 0.5rem;
    margin-bottom: 0;
    padding: 0.5rem 0.75rem;
    background-color: var(--_category-color);
    border-radius: 100vw;
  }

  #article-page h1 {
    width: fit-content;
  }

  .filters {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .filter-btn {
    cursor: pointer;
    background: #ddd;
    border: 1px solid #ddd;
    padding: 0.5em 1em;
  }

  .filter-btn.active {
    background: light-dark(#222, #bbb);
    color: light-dark(white, #222);
  }
}

@layer warnings {
  .warnings {
    position: sticky;

    @media (prefers-color-scheme: dark) {
      color: #222;
    }
  }

  .warnings > * {
    display: none;
    margin-block: 0.25em;
    padding: 1em;
  }

  [data-reason='prefers-reduced-motion'] {
    border: 1px solid #ccc;
    background-color: rgb(205 230 255 / 0.95);

    @media (prefers-reduced-motion: reduce) {
      display: block;
    }
  }

  .not-supported {
    border: 1px solid #ccc;
    background-color: rgb(255 255 205 / 0.95);
  }

  [data-reason='cross-document-view-transitions'] {
    @supports not (view-transition-name: root) {
      display: block;
    }
  }
}

@layer reset {
  *,
  *::before,
  *::after {
    box-sizing: border-box;
  }

  html {
    font-family: system-ui, sans-serif;
    scrollbar-gutter: stable both-edges;
    color-scheme: light dark;
  }

  body {
    margin: 0;
  }

  img {
    display: block;
    max-width: 100%;
  }
}
